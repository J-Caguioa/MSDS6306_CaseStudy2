---
title: "Analysis"
author: "Lavonnia Newman, Jeff Washburn, & Joseph Caguioa"
date: "2/25/2019"
output: 
  html_document:
    theme: default
    highlight: tango
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: false

---

```{r setup, include=F, message=F, results="hide", warning=F}
knitr::opts_chunk$set(echo = TRUE)

package_list <- c("tidyverse", "readxl", "knitr", "mlr", "kableExtra")
lapply(package_list, library, character.only=T)

theme_set(theme_bw())

```

# Introduction

Insert scenario.

Address the following questions in analysis:
* Identify three or more factors that contribute to employee turnover.
* Do other job-specific trends exist?

# Load Data

```{r load1}

# Read in data set. [#2A]
employee <- read_excel('Data/DDSAnalytics_Data.xlsx', sheet = "HR-employee-attrition Data")

# Size of data set. [#2A]
employee_dim <- as.matrix(dim(employee))
rownames(employee_dim) <- c("Rows", "Columns")
kable(employee_dim, col.names = "Size", row.names = T,
      caption = "Data Set Dimensions", table.attr="style='width:30%;'") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))

```

The data set contains observations on 1,470 employees with information on 35 variables.

```{r load2}

# Modify column names. All names less than 12 characters. [#2B]
renamed <- read_excel('Data/VariableNames.xlsx')
colnames(employee) <- renamed$`Modified Name`

# Convert column types. [#2D]
# factorize <- c("Attrition", "BusinessTravel", "Department", "EducationField", "EnvironmentSatisfaction", "Gender", "JobInvolvement", "JobLevel", "JobRole", "JobSatisfaction", "MaritalStatus", "Over18", "OverTime", "PerformanceRating", "RelationshipSatisfaction", "WorkLifeBalance")
# employee[factorize] <- lapply(employee[factorize], as.factor)

```

# Preliminary Analysis

```{r underage}

# Remove <18-year-olds. [#3A]

```

```{r descriptive}

# Descriptive statistics (7) and histograms (2) for interesting variables. [#3B]

```

```{r frequencies}

# Frequencies for Gender, Education, and Occupation. [#3C]

```


```{r management}

# Counts of management positions. [#3D]

```

# Deep Analysis

```{r age-income}

# Relationship between Age and Income. [#4C]
cor(employee$Age, employee$MnthInc)

lm1 <- lm(MnthInc ~ Age, employee)
summary(lm1)

ggplot(employee, aes(x=Age, y=MnthInc, color=Gender)) +
  geom_point(alpha=0.3) +
  xlab("Age (years)") +
  ylab("Monthly Income ($)") +
  ggtitle("Monthly Income Rises with Age") +
  theme(axis.ticks = element_blank(),
        plot.title = element_text(hjust = 0.5)) +
  geom_smooth(method = "lm",
              se = F,
              level = 0.95)

```

```{r income-vs-others}

# Relationship between education and income.
ggplot(employee, aes(x=factor(Education), y=MnthInc, group=Education, fill=Education)) +
  geom_boxplot() +
  xlab("Level of Education") +
  ylab("Monthly Income ($)") +
  ggtitle("Monthly Income and Education") +
  scale_x_discrete(labels = c("Below College",
                              "College",
                              "Bachelor",
                              "Master",
                              "Doctor")) +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.ticks = element_blank(),
        legend.position = 'none')

# Relationship between job role and income.
ggplot(employee, aes(x=JobRole, y=MnthInc, group=JobRole)) +
  geom_boxplot() +
  coord_flip()

# Relationship between education field and income.
ggplot(employee, aes(x=EduField, y=MnthInc, group=EduField)) +
  geom_boxplot() +
  coord_flip()

# Total working years vs income
ggplot(employee, aes(x=TotalWrkYrs, y=MnthInc)) +
  geom_point()

lm2 <- lm(MnthInc ~ TotalWrkYrs, employee)
cor(employee$TotalWrkYrs, employee$MnthInc)
# Note: 0.77 cor, R2 ~ 0.597 ***

# Years at company vs income
ggplot(employee, aes(x=YrsAtComp, y=MnthInc)) +
  geom_point()

```


```{r life-satisfaction}

# Can life satisfaction be defined?

```

# Conclusion

* Identify three factors contributing to turnover.
* Identify any existing job-specific trends.
* Other considerations, such as next steps or other variables needed.
